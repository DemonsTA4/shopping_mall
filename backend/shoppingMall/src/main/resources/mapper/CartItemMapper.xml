<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="org.example.shoppingmall.mapper.CartItemMapper">    <!-- 结果映射 -->    <resultMap id="BaseResultMap" type="org.example.shoppingmall.entity.CartItem">        <id column="id" property="id" />        <result column="quantity" property="quantity" />        <association property="cart" javaType="org.example.shoppingmall.entity.Cart">            <id column="cart_id" property="id" />        </association>        <association property="product" javaType="org.example.shoppingmall.entity.Product">            <id column="product_id" property="id" />            <result column="product_name" property="name" />            <result column="product_price" property="price" />            <result column="product_image_url" property="imageUrl" />        </association>    </resultMap>        <!-- 基础列 -->    <sql id="Base_Column_List">        ci.id, ci.quantity, ci.cart_id, ci.product_id,         p.name as product_name, p.price as product_price, p.image_url as product_image_url    </sql>        <!-- 插入操作 -->    <insert id="insert" parameterType="org.example.shoppingmall.entity.CartItem" useGeneratedKeys="true" keyProperty="id">        INSERT INTO cart_items (            cart_id, product_id, quantity        ) VALUES (            #{cart.id}, #{product.id}, #{quantity}        )    </insert>        <!-- 更新操作 -->    <update id="update" parameterType="org.example.shoppingmall.entity.CartItem">        UPDATE cart_items        <set>            <if test="quantity != null">quantity = #{quantity},</if>        </set>        WHERE id = #{id}    </update>        <!-- 更新购物车项的数量 -->    <update id="updateQuantity">        UPDATE cart_items SET quantity = #{quantity}        WHERE id = #{id}    </update>        <!-- 删除操作 -->    <delete id="deleteById" parameterType="java.lang.Integer">        DELETE FROM cart_items WHERE id = #{id}    </delete>        <!-- 根据ID查询 -->    <select id="selectById" parameterType="java.lang.Integer" resultMap="BaseResultMap">        SELECT <include refid="Base_Column_List" />        FROM cart_items ci        LEFT JOIN products p ON ci.product_id = p.id        WHERE ci.id = #{id}    </select>        <!-- 根据购物车ID查询所有购物车项 -->    <select id="selectByCartId" parameterType="java.lang.Integer" resultMap="BaseResultMap">        SELECT <include refid="Base_Column_List" />        FROM cart_items ci        LEFT JOIN products p ON ci.product_id = p.id        WHERE ci.cart_id = #{cartId}    </select>        <!-- 根据购物车ID和商品ID查询购物车项 -->    <select id="selectByCartIdAndProductId" resultMap="BaseResultMap">        SELECT <include refid="Base_Column_List" />        FROM cart_items ci        LEFT JOIN products p ON ci.product_id = p.id        WHERE ci.cart_id = #{cartId} AND ci.product_id = #{productId}    </select>        <!-- 从购物车中删除指定商品 -->    <delete id="deleteByCartIdAndProductId">        DELETE FROM cart_items         WHERE cart_id = #{cartId} AND product_id = #{productId}    </delete>        <!-- 清空购物车中的所有项 -->    <delete id="deleteByCartId" parameterType="java.lang.Integer">        DELETE FROM cart_items WHERE cart_id = #{cartId}    </delete>        <!-- 检查是否存在某商品 -->    <select id="countByCartIdAndProductId" resultType="int">        SELECT COUNT(*) FROM cart_items        WHERE cart_id = #{cartId} AND product_id = #{productId}    </select></mapper>